# Inception 

This project consists in having you set up a small infrastructure composed of different services as MariaDB, Wordpress and Nginx, under specific rules. \
The whole project has to be done in a virtual machine. \
You have to use docker compose. \
For performance matters, the containers must be built either from the penultimate stable version of Alpine or Debian. \
You also have to write your own Dockerfiles, one per service. The Dockerfiles must be called in your docker-compose.yml by your Makefile. \
For security reasons, the latest tag is prohibited and no password or credentials must be present in your Dockerfiles. \
It is mandatory to use environment variables and it is strongly recommended to use a .env file to store them. That file should be located at the root of the srcs directory.


Here is an example diagram of the expected result:
<div align="center">
  <img src="https://github.com/MofMiq/InceptionALa3VaLaVencida/blob/main/diagram.png" width="600"/>
</div>


## üü©  Basics of Docker and its key components
### Docker
Docker is an open-source platform that automates the deployment, scaling, and management of applications using containerization.
It enables developers to package applications with all their dependencies into a standardized unit called a container, ensuring that the application runs consistently across different environments.

### Containers
Containers are lightweight, portable units that package an application and its dependencies together. They share the host system's OS kernel but run in isolated user spaces.
This isolation ensures that containers do not interfere with each other and that the application runs the same way, regardless of where it is deployed.

### Images
Docker images are read-only templates used to create containers. They contain the application code, runtime, libraries, environment variables, and configuration files needed to run the application.
An image is built from a Dockerfile, which is a script that contains a series of commands to assemble the image.

Drawing a parallel with code, an image is like a class, while a container is an instance of that class. Because of this, we can have multiple containers running from the same image.

### Volumes
Volumes are storage areas used to persist data generated by Docker containers. Unlike the container's writable layer, volumes exist outside of the container's filesystem and are managed by Docker,
making them ideal for data that needs to be preserved across container restarts and updates.

### Networks
Docker networks enable communication between Docker containers. They provide isolation and control over the networking aspects, such as defining which containers can communicate with each other
and setting up different networking configurations (e.g., bridge, host, overlay).


## üü™  Mandatory services:
### MariaDB
MariaDB is a popular open-source relational database management system that is a fork of MySQL. It is used to store and manage data in a structured format, allowing for efficient retrieval
and manipulation of data.

### WordPress
WordPress is a widely-used open-source content management system written in PHP. It allows users to create, manage, and publish content on the web easily. WordPress stores its content,
configuration settings, and user data in a database, which is typically managed by sevices like MariaDB.

### Nginx
Nginx is a high-performance web server and reverse proxy server. It is known for its speed, scalability, and ability to handle a large number of concurrent connections with low resource usage.
Nginx can serve static content and proxy dynamic content to application servers like PHP processors.


## üü¶  Virtual machine configuration
### Shared Folder:
‚Ä¢ In VirtualBox -> Settings -> Shared Folders -> Add -> Enter the name and path where you want the folder to be located, and check the Make permanent box. \
‚Ä¢ Inside the virtual machine -> create a folder in /mnt -> this is the mount point inside the virtual machine. \
‚Ä¢ Then execute the following command:
```bash
sudo mount -t vboxsf <folder_created_in_VB> <path_to_mounted_folder_in_vm>
```

### Installations:
```bash
apt install -y sudo ufw docker docker docker-compose make openbox xinit kitty firefox-esr
```
‚Ä¢ **sudo**: to grant permissions to execute Docker. \
‚Ä¢ **ufw**: to configure ports. \
‚Ä¢ **docker**: allows us to build, ship, and run distributed applications. \
‚Ä¢ **docker-compose**: allows defining and running multi-container Docker applications. \
‚Ä¢ **make**: to automate the build process. \
‚Ä¢ **openbox**: a lightweight and highly customizable window manager. \
‚Ä¢ **xinit**: a program that initializes the X display server and runs startup programs in a user environment. \
‚Ä¢ **kitty**: terminal emulator. \
‚Ä¢ **firefox-es**: stable version of Firefox. 

### Configure ssh:
‚Ä¢ vim /etc/ssh/sshd_config -> Port 42 \
‚Ä¢ service ssh restart && service sshd restart 

### Configure ufw:
‚Ä¢ ufw enable && ufw allow 443/80/42

### Port forwarding in VB:
‚Ä¢ In VirtualBox -> Settings -> Network -> Advanced -> Port forwarding
  - **ssh** -> 42:42
  - **http** -> 80:80
  - **https** -> 443:443 

### Localhost problems:
‚Ä¢ Ensure there are no local entries (localhost) in ~/.ssh/known_hosts 

### Add user to the docker group and grant sudo permissions

### Move the virtual machine to goinfre to be faster tha light:
‚Ä¢ In VirtualBox -> Export Appliance -> Select machine -> file: select the path to save the .ova -> /goinfre/$USER \
‚Ä¢ In VirtualBox -> Import Appliance -> Select -> select the .ova you want to import. \
‚Ä¢ Then select the path to place the new .vdi that will be decompressed during the import -> /goinfre/$USER 


## üü®  Useful Commands:
‚Ä¢ ```docker pull <service>```: downloads the image of the desired service. \
‚Ä¢ ```docker create <image>```: creates the container. \
‚Ä¢ ```docker start <container_id>```: starts the container of the desired image. \
‚Ä¢ ```docker ps```: returns a table with various useful data such as ID, image, status, ports, among other things. If we add the -a flag, it lists all containers regardless of whether they are running or not. \
‚Ä¢ ```docker stop <container>```: stops the container without deleting it. \
‚Ä¢ ```docker rm [-f] <container_id>```: deletes the container. Without the '-f' flag, it deletes stopped containers; with the flag active, it deletes running containers as well. \
‚Ä¢ ```docker rmi [-f] <image>```: deletes the container image. Without the '-f' flag, it will fail if any instance of the container is running; with the flag active, it forces the deletion of an image no matter what. \
‚Ä¢ ```docker create --name <name> <image>```: creates an image but with the name we want. Just as we can specify the name, we can specify many more characteristics to the image with different arguments. \
‚Ä¢ ```docker logs```: displays the messages and possible errors when mounting the containers. \
‚Ä¢ ```docker run```: is the fastest and most effective way to create and start a container. \
  ‚ÅÉ If it finds the image, it downloads it. \
  ‚ÅÉ Creates the container. \
  ‚ÅÉ Starts the container. \
‚Ä¢ ```docker run -d <image>```: 'detached' mode to start the container without showing the logs. With this command, we can create as many containers as we execute it. It only downloads the image once, but it can create multiple instances. \
‚Ä¢ ```docker network ls```: shows the host's networks. \
‚Ä¢ ```docker network create <name>```: creates an internal network in Docker so that containers can communicate with each other. \
‚Ä¢ ```docker network rm <name>```: deletes the internal Docker network. \
‚Ä¢ ```docker volume ls```: lists the volumes created to store container data. \
‚Ä¢ ```docker volume rm <name>```: deletes the volume. \
‚Ä¢ ```docker build```: command to create an image based on a Dockerfile. \
‚Ä¢ ```docker build -t <name> <path>```: builds an image and tags it with the specified name. \
‚Ä¢ ```docker compose up```: builds the containers defined in the docker-compose.yml. \
‚Ä¢ ```docker compose down```: cleans up everything created by docker-compose.yml. \
‚Ä¢ ```docker exec -it <container> sh```: is used to execute commands inside a running container. It opens a shell session inside the container, allowing for command execution and administration/debugging tasks inside the container. 
